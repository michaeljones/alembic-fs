#!/bin/sh

set -e

# Get directory where this script is living
afsbin=${0%%abcdebug}

# Get name of the Alembic file and directory we'll be creating
abc=$1
dir=${abc}d

# Set useful environment variables so the information is accessible from within
# the mounted session
export AFS_FILE_PATH=`readlink -f -n $abc`
export AFS_ROOT=`readlink -f -n $dir`

# Create the mount directory
mkdir -p $dir

# Mount the FUSE filesystem
$afsbin/alembic-fs -d -s $dir $abc

cd $dir

# Start up the user's preferred shell - this runs until the user exits it and
# then the rest of this script continues
$SHELL

cd -

# Unmount the FUSE filesystem
fusermount -u $dir

# Remove the mount directory
rmdir $dir

